<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Veille LinkedIn ‚Äì Flux</title>
<link href="https://unpkg.com/@picocss/pico@2.0.6/css/pico.min.css" rel="stylesheet">
<style>
:root{
  --bg: #0b0c0f;
  --card: #111318;
  --border: #1b1e25;
  --text: #e9ecf1;
  --muted: #a7b0be;
  --accent: #4f8cff;
  --accent-2: #7aa2ff;
}
@media (prefers-color-scheme: light){
  :root{
    --bg:#f7f8fb; --card:#ffffff; --border:#e7e8ee; --text:#0d1117; --muted:#5b6472; --accent:#3b82f6; --accent-2:#60a5fa;
  }
}
html,body{background:var(--bg); color:var(--text)}
body{max-width:900px;margin:auto;padding:18px}
h2{font-weight:700;letter-spacing:.2px;margin:4px 0 12px}
.header-sub{color:var(--muted);font-size:.95rem;margin-bottom:16px}
.controls{
  position: sticky; top: 0; z-index: 20;
  display:grid; grid-template-columns:1fr 200px 140px 170px; gap:10px; margin:12px 0 14px;
  padding:12px; border:1px solid var(--border); border-radius:14px; background:color-mix(in oklab, var(--card) 88%, transparent 12%);
  -webkit-backdrop-filter:saturate(120%) blur(6px); backdrop-filter:saturate(120%) blur(6px)
}
@media(max-width:900px){.controls{grid-template-columns:1fr 1fr}}
button.secondary, select, input{background:var(--card); color:var(--text); border:1px solid var(--border)}
button.secondary:hover{border-color:color-mix(in oklab, var(--accent) 40%, var(--border))}
#reload{justify-self:end}
.count{color:var(--muted);font-size:.92rem;margin:6px 0 10px}
.grid{display:grid; grid-template-columns:1fr; gap:18px}
.card{
  border:1px solid var(--border); border-radius:16px; overflow:hidden; background:var(--card); display:flex; flex-direction:column;
  box-shadow:0 6px 18px rgba(0,0,0,.12)
}
.head{display:flex;align-items:center;gap:12px;padding:14px 16px 8px 16px}
.head img{width:34px;height:34px;border-radius:50%;object-fit:cover;border:1px solid var(--border)}
.head .who{display:flex;flex-direction:column;gap:2px}
.head .name{font-weight:600}
.head .meta{color:var(--muted);font-size:.88rem}
.badges{display:flex;gap:8px;flex-wrap:wrap;padding:2px 16px 10px 16px}
.badge{font-size:.82rem;border:1px solid var(--border);border-radius:999px;padding:4px 10px;color:var(--text);background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(0,0,0,.03))}
.badge.link a{color:var(--text);text-decoration:none}
.badge.link a:hover{color:var(--accent)}
.embed{width:100%; aspect-ratio:16/9; background:#0f1116; border-top:1px solid var(--border)}
.embed iframe{width:100%; height:100%; border:0; border-bottom:1px solid var(--border)}
.fallback{padding:14px 16px;font-size:1rem;line-height:1.4;color:var(--text)}
.footer-actions{display:flex;gap:10px;padding:12px 16px 16px 16px}
.footer-actions a{border:1px solid var(--border); border-radius:12px; padding:8px 12px; text-decoration:none; color:var(--text); background:var(--card)}
.footer-actions a:hover{border-color:var(--accent)}
hr.sep{border:none;border-top:1px solid var(--border);margin:0}
</style>
</head>
<body>
<h2>Veille LinkedIn</h2>
<p class="header-sub">Dernier run Apify ‚Ä¢ filtres front ‚Ä¢ flux int√©gr√© responsive</p>

<div class="controls">
  <input id="q" type="search" placeholder="Filtrer par mots-cl√©s‚Ä¶">
  <select id="author"><option value="">Tous auteurs</option></select>
  <input id="minLikes" type="number" min="0" value="0" placeholder="Likes min">
  <select id="sort">
    <option value="dateDesc">R√©cents ‚Üí anciens</option>
    <option value="dateAsc">Anciens ‚Üí r√©cents</option>
    <option value="likesDesc">Likes ‚Üì</option>
    <option value="commentsDesc">Commentaires ‚Üì</option>
  </select>
</div>

<div class="count" id="count"></div>
<div id="grid" class="grid"></div>

<script>
const DATA_URL = "https://api.apify.com/v2/acts/supreme_coder~linkedin-post/runs/last/dataset/items?token=apify_api_KY6uoGqkXVFhCzeYBQO0OQFjnGs2RB3HzGy9";
let RAW=[], VIEW=[];

function getActivityId(item){
  const u = item.urn || item.shareUrn || "";
  const m1 = u.match(/activity:(\d+)/);
  if (m1) return m1[1];
  const url = item.url || "";
  const m2 = url.match(/activity-(\d+)/) || url.match(/urn:li:activity:(\d+)/);
  return m2 ? m2[1] : null;
}

function mapItem(o){
  const author = (o.author && o.author.name) || o.authorName || "";
  const authorLogo = (o.author && o.author.logoUrl) || o.authorProfilePicture || "";
  const authorUrl = (o.author && o.author.universalName) ? ("https://www.linkedin.com/company/"+o.author.universalName+"/") : (o.authorProfileUrl || "");
  const date = o.postedAtISO ? new Date(o.postedAtISO) : (o.postedAtTimestamp ? new Date(o.postedAtTimestamp) : null);
  const likes = Number(o.numLikes || o.reactions || 0);
  const comments = Number(o.numComments || 0);
  const text = o.text || "";
  const url = o.url || "";
  const activityId = getActivityId(o);
  return { author, authorLogo, authorUrl, date, likes, comments, text, url, activityId };
}

function uniq(a){ return Array.from(new Set(a.filter(Boolean))); }

function render(posts){
  const grid=document.getElementById("grid");
  const count=document.getElementById("count");
  grid.innerHTML="";
  count.textContent = posts.length ? posts.length+" posts" : "Aucun post ne correspond aux filtres";

  posts.forEach(p=>{
    const card=document.createElement("article");
    card.className="card";

    const head=document.createElement("div");
    head.className="head";
    head.innerHTML=(p.authorLogo?('<img src="'+p.authorLogo+'" alt="">'):"")+'<div class="who"><span class="name">'+(p.author||"")+'</span><span class="meta">'+(p.date?p.date.toLocaleString("fr-FR"):"")+'</span></div>';
    card.appendChild(head);

    const badges=document.createElement("div");
    badges.className="badges";
    badges.innerHTML='<span class="badge">üëç '+p.likes+'</span><span class="badge">üí¨ '+p.comments+'</span>'+ (p.url?('<span class="badge link"><a href="'+p.url+'" target="_blank" rel="noopener">Ouvrir LinkedIn</a></span>'):"");
    card.appendChild(badges);

    const wrap=document.createElement("div");
    if (p.activityId){
      wrap.className="embed";
      const src='https://www.linkedin.com/embed/feed/update/urn:li:activity:'+p.activityId;
      const iframe=document.createElement("iframe");
      iframe.src=src; iframe.allowFullscreen=true; iframe.title="LinkedIn post";
      wrap.appendChild(iframe);
    } else {
      wrap.className="fallback";
      wrap.textContent = p.text ? (p.text.length>320 ? p.text.slice(0,320)+"‚Ä¶" : p.text) : "Aper√ßu indisponible";
    }
    card.appendChild(wrap);

    const hr=document.createElement("hr"); hr.className="sep"; card.appendChild(hr);

    const actions=document.createElement("div");
    actions.className="footer-actions";
    if(p.url){ const a=document.createElement("a"); a.href=p.url; a.target="_blank"; a.rel="noopener"; a.textContent="Voir le post"; actions.appendChild(a); }
    if(p.authorUrl){ const a2=document.createElement("a"); a2.href=p.authorUrl; a2.target="_blank"; a2.rel="noopener"; a2.textContent="Voir la page"; actions.appendChild(a2); }
    card.appendChild(actions);

    grid.appendChild(card);
  });
}

function applyFilters(){
  const q=document.getElementById("q").value.trim().toLowerCase();
  const author=document.getElementById("author").value;
  const minLikes=Number(document.getElementById("minLikes").value||0);
  const sort=document.getElementById("sort").value;

  let arr=RAW.slice();

  if(q){
    arr=arr.filter(p=>
      (p.text && p.text.toLowerCase().includes(q)) ||
      (p.author && p.author.toLowerCase().includes(q))
    );
  }
  if(author){ arr=arr.filter(p=>p.author===author); }
  if(minLikes>0){ arr=arr.filter(p=>p.likes>=minLikes); }

  if(sort==="dateDesc") arr.sort((a,b)=>(b.date?.getTime()||0)-(a.date?.getTime()||0));
  else if(sort==="dateAsc") arr.sort((a,b)=>(a.date?.getTime()||0)-(b.date?.getTime()||0));
  else if(sort==="likesDesc") arr.sort((a,b)=>b.likes-a.likes);
  else if(sort==="commentsDesc") arr.sort((a,b)=>b.comments-a.comments);

  VIEW=arr;
  render(VIEW);
}

async function load(){
  const res=await fetch(DATA_URL,{cache:"no-store"});
  const data=await res.json();
  const list=Array.isArray(data)?data:(Array.isArray(data.items)?data.items:[]);
  RAW=list.map(mapItem);
  const authors=uniq(RAW.map(p=>p.author)).sort((a,b)=>a.localeCompare(b,"fr"));
  const sel=document.getElementById("author");
  sel.innerHTML='<option value="">Tous auteurs</option>'+authors.map(a=>'<option value="'+a+'">'+a+'</option>').join("");
  applyFilters();
}

document.getElementById("q").addEventListener("input",applyFilters);
document.getElementById("author").addEventListener("change",applyFilters);
document.getElementById("minLikes").addEventListener("input",applyFilters);
document.getElementById("sort").addEventListener("change",applyFilters);

const reloadBtn=document.getElementById("reload");
if(reloadBtn){ reloadBtn.addEventListener("click",load); }

load();
</script>
</body>
</html>

